{"version":3,"sources":["webpack:///webpack/bootstrap d4dfa07ae399328199b3","webpack:///./AdminModals.js"],"names":["AdminModals","init","bindModals","userSettings","window","AdminModalsSettings","settings","modalActionSelector","dataAttribute","adminModalPageUrl","adminModalFrameFormSelector","magicParamKey","adminModalsUniqueParamKey","Object","keys","forEach","key","events","uniqueIdPrefix","Math","random","toString","uniqueIdCounter","addEventListener","e","receiveStorageMessage","that","$","document","on","$this","tagName","prop","toLowerCase","modalOpenOptions","url","method","data","attr","modalOpen","options","$modal","combineUrl","find","click","modal","$frame","ready","loadInFrame","uniqueId","localStorage","removeItem","remove","closeCallback","off","frameDocument","contentWindow","location","$form","value","append","val","submit","extractFormButtons","resizeModal","magicParamValue","indexOf","console","log","newValue","parsedMessage","match","dontResizeWindow","maxWindowHeight","minWindowHeight","$frameDocument","parentHeightLimit","windowHeightLimit","floor","height","frameHeight","max","newHeight","css","frameWindow","f$","$buttons","$modalButtons","each","$modalButton","outerHTML","push","hide","empty"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d4dfa07ae399328199b3","class AdminModals {\n  constructor() {\n    this.init();\n\n    this.bindModals();\n  }\n\n  init() {\n    const userSettings = window.AdminModalsSettings || {};\n    const settings = {\n      modalActionSelector: '.admin-modal-trigger',\n      dataAttribute: 'adminModals',\n      adminModalPageUrl: '/site/admin-modal',\n      adminModalFrameFormSelector: '.admin-modal__frame-form',\n      magicParamKey: '__admin_modals',\n      adminModalsUniqueParamKey: '__admin-modals__unique-id'\n    };\n    Object.keys(userSettings).forEach(key => {\n      settings[key] = userSettings[key];\n    });\n    this.settings = settings;\n\n    this.events = {};\n    this.uniqueIdPrefix = Math.random().toString();\n    this.uniqueIdCounter = 0;\n\n    window.addEventListener('storage', (e) => this.receiveStorageMessage(e));\n  }\n\n  bindModals() {\n    const that = this;\n\n    $(document).on('click', this.settings.modalActionSelector, function () {\n      const $this = $(this);\n      const tagName = $this.prop('tagName').toLowerCase();\n      const modalOpenOptions = {\n        url: '#',\n        method: 'GET',\n        data: {}\n      };\n      switch (tagName) {\n        case 'a':\n          modalOpenOptions.url = $this.attr('href');\n          modalOpenOptions.data = $this.data(that.settings.dataAttribute) || {};\n          break;\n\n        case 'button':\n        case 'input':\n\n          break;\n        default:\n          break;\n      }\n      that.modalOpen(modalOpenOptions);\n      return false;\n    });\n  }\n\n  modalOpen(options) {\n    // create modal\n    const $modal = $(`\n<div class=\"modal fade AdminModal\" tabindex=\"-1\" role=\"dialog\" style=\"display:none;\">   \n      <div class=\"modal-header\">\n        <a href=\"#\" data-dismiss=\"modal\" aria-hidden=\"true\" class=\"pull-right\">\n            <i class=\"fa fa-times fa-2x\"></i>\n        </a>\n        <a href=\"${this.combineUrl(options, 'tab')}\" target=\"_blank\" class=\"modal-title\">\n            ${options.url}\n        </a>\n      </div>\n     \n      <iframe src=\"${this.settings.adminModalPageUrl}\" frameborder=\"0\" class=\"modal-body modal-frame\"></iframe>\n    \n      <div class=\"modal-footer\">\n        \n      </div>  \n</div>`);\n    $modal.find('.modal-title').click(function() {\n      $modal.modal('hide');\n      return true;\n    });\n    $modal.data('adminModalsUniqueId', ++this.uniqueIdCounter);\n\n    $modal\n      .on('shown.bs.modal', () => {\n        const $frame = $modal.find('.modal-frame');\n        $frame.ready(() => {\n          this.loadInFrame($frame, options, $modal);\n          return false;\n        });\n      })\n      .on('hidden.bs.modal', () => {\n        const uniqueId = $modal.data('adminModalsUniqueId');\n        // stop listening for storage\n        localStorage.removeItem(`adminModalsMessage:${uniqueId}`);\n        delete this.events[uniqueId];\n        // remove modal DOM element\n        $modal.remove();\n\n        if (options.closeCallback) {\n          options.closeCallback();\n        }\n      });\n\n    $modal.modal('show');\n  }\n\n  loadInFrame($frame, options, $modal) {\n    $frame.off('ready');\n    const frameDocument = $frame[0].contentWindow.document;\n\n    options.data[this.settings.adminModalsUniqueParamKey] =\n      `${this.uniqueIdPrefix}_${$modal.data('admin-modals-unique-id')}`;\n\n    if (options.method === 'GET') {\n      frameDocument.location = this.combineUrl(options, 'modal');\n    } else {\n      // it's post\n      const $form = $frame.find(this.settings.adminModalFrameFormSelector);\n      $form.attr('action', this.combineUrl(options.url, 'modal'));\n      Object.keys(options.data).forEach((key) => {\n        const value = options.data[key];\n        $form.append(\n          $('<input type=\"hidden\">')\n            .attr('name', key)\n            .val(value)\n        );\n      });\n      $form.submit();\n    }\n    this.events[$modal.data('adminModalsUniqueId')] = () => {\n      AdminModals.extractFormButtons($frame, options, $modal);\n      AdminModals.resizeModal($frame, options, $modal);\n    };\n  }\n\n  static resizeModal($frame, options, $modal) {\n    if (options.dontResizeWindow === true) {\n      return;\n    }\n    // const maxWindowWidth = options.maxWindowWidth || 95;\n    const maxWindowHeight = options.maxWindowHeight || 80;\n    // const minWindowWidth = options.minWindowWidth || 300;\n    const minWindowHeight = options.minWindowHeight || 200;\n\n    const $frameDocument = $($frame[0].contentWindow.document);\n    // const parentWidthLimit = (options.windowWidthLimit || Math.floor($(window).width() * maxWindowWidth / 100)) - 60;\n    const parentHeightLimit = (options.windowHeightLimit || Math.floor($(window).height() * maxWindowHeight / 100)) - 100;\n    // const frameWidth = Math.max($frameDocument.width() + 20, minWindowWidth);\n    const frameHeight = Math.max($frameDocument.height(), minWindowHeight);\n    // const newWidth = frameWidth < parentWidthLimit ? frameWidth : parentWidthLimit;\n    const newHeight = frameHeight < parentHeightLimit ? frameHeight : parentHeightLimit;\n\n    $modal.find('.modal-dialog').css('display', 'table');\n    // $frame.width(newWidth);\n    $frame.attr('style', `${$frame.attr('style')}; height: ${newHeight}px !important`);\n  }\n\n  static extractFormButtons($frame, options, $modal) {\n    const frameWindow = $frame[0].contentWindow;\n    const f$ = frameWindow.$;\n    const $buttons = f$('.form-group,.form-actions,.admin-modals__form-buttons').find('input[type=submit],button[type=submit],.btn');\n    const $modalButtons = [];\n    $buttons.each(function() {\n      const $modalButton = $(this.outerHTML);\n      $modalButton.click(() => $(this).click());\n      $modalButtons.push($modalButton);\n      $(this).hide();\n    });\n\n    $modal.find('.modal-footer')\n      .empty()\n      .append(\n        $modalButtons\n      );\n  }\n\n  combineUrl(options, magicParamValue = 'modal') {\n    let url = options.url;\n    url += url.indexOf('?') >= 0 ? '&' : '?';\n    url += `${this.settings.magicParamKey}=${magicParamValue}`;\n\n    if (options.method === 'GET') {\n      // append data\n      Object.keys(options.data).forEach(key => {\n        const value = options.data[key];\n        url += `&${key}=${value}`;\n      });\n    }\n    return url;\n  }\n\n  receiveStorageMessage(e) {\n    console.log('message: ', e);\n    if (e.newValue === 'loaded' && e.key.indexOf('adminModalsMessage') === 0) {\n      const parsedMessage = e.key.match(/^adminModalsMessage:([\\d.]*)_([\\d]*)$/);\n      if (parsedMessage === null) {\n        // not a valid key\n        return;\n      }\n      if (parsedMessage[1] !== this.uniqueIdPrefix) {\n        // not our message\n        return;\n      }\n      localStorage.removeItem(e.key);\n      // const messageId = `${parsedMessage[1]}_${parsedMessage[2]}`;\n      this.events[parsedMessage[2]]();\n    }\n  }\n}\n\nwindow.AdminModals = new AdminModals();\n\n\n\n// WEBPACK FOOTER //\n// ./AdminModals.js"],"sourceRoot":""}